---
sidebar_position: 1
---

# Docker Compose Deployment

Deploy Aurora using Docker Compose for single-server or development deployments.

## Overview

Aurora provides three Docker Compose configurations:

| File | Use Case |
|------|----------|
| `docker-compose.yaml` | Local development with hot-reload |
| `docker-compose.prod-local.yml` | Production-like testing locally |
| `prod.docker-compose.yml` | Production deployment |

## Production Deployment

### Prerequisites

- Docker 24.0+ and Docker Compose v2
- Server with 8GB+ RAM (16GB recommended)
- Domain name with SSL certificate (for production)
- LLM API key

### 1. Clone and Configure

```bash
git clone https://github.com/arvo-ai/aurora.git
cd aurora

# Initialize configuration
make init
```

### 2. Configure Environment

Edit `.env` with production values:

```bash
# Required
OPENROUTER_API_KEY=sk-or-v1-your-production-key

# URLs (update for your domain)
FRONTEND_URL=https://aurora.yourdomain.com
NEXT_PUBLIC_BACKEND_URL=https://api.aurora.yourdomain.com
NEXT_PUBLIC_WEBSOCKET_URL=wss://ws.aurora.yourdomain.com

# Security (auto-generated by make init, but verify they exist)
POSTGRES_PASSWORD=<64-char-random-string>
FLASK_SECRET_KEY=<64-char-random-string>
AUTH_SECRET=<64-char-random-string>
```

### 3. Start Production Stack

```bash
make prod
```

### 4. Configure Vault Token

```bash
# Get root token
docker logs vault-init 2>&1 | grep "Root Token:"

# Add to .env
echo "VAULT_TOKEN=hvs.xxxxx" >> .env

# Restart
make prod-down && make prod
```

### 5. Set Up Reverse Proxy

Configure nginx or Traefik to proxy to Aurora services:

```nginx
# /etc/nginx/sites-available/aurora
server {
    listen 443 ssl;
    server_name aurora.yourdomain.com;

    ssl_certificate /etc/letsencrypt/live/aurora.yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/aurora.yourdomain.com/privkey.pem;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}

server {
    listen 443 ssl;
    server_name api.aurora.yourdomain.com;

    ssl_certificate /etc/letsencrypt/live/aurora.yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/aurora.yourdomain.com/privkey.pem;

    location / {
        proxy_pass http://localhost:5080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

server {
    listen 443 ssl;
    server_name ws.aurora.yourdomain.com;

    ssl_certificate /etc/letsencrypt/live/aurora.yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/aurora.yourdomain.com/privkey.pem;

    location / {
        proxy_pass http://localhost:5006;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
    }
}
```

## Production Commands

| Command | Description |
|---------|-------------|
| `make prod` | Build and start production stack |
| `make prod-down` | Stop production stack |
| `make prod-logs` | View logs |
| `make prod-logs aurora-server` | View specific service logs |
| `make prod-build` | Build without starting |
| `make prod-clean` | Stop and remove volumes |
| `make prod-nuke` | Full cleanup |
| `make prod-fresh` | Clean rebuild from scratch |

## Service Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                     Reverse Proxy (nginx)                    │
│                 (SSL termination, routing)                   │
└─────────────────────────────────────────────────────────────┘
         │                    │                    │
         ▼                    ▼                    ▼
    ┌─────────┐         ┌─────────┐         ┌─────────┐
    │Frontend │         │  API    │         │ Chatbot │
    │  :3000  │         │ :5080   │         │  :5006  │
    └─────────┘         └─────────┘         └─────────┘
                              │
                              ▼
                     ┌─────────────────┐
                     │  Celery Worker  │
                     │ (background)    │
                     └─────────────────┘
                              │
    ┌─────────────────────────┼─────────────────────────┐
    │           │             │             │           │
    ▼           ▼             ▼             ▼           ▼
┌───────┐ ┌─────────┐ ┌──────────┐ ┌───────┐ ┌─────────┐
│Postgres│ │  Redis  │ │ Weaviate │ │ Vault │ │SeaweedFS│
│ :5432  │ │  :6379  │ │  :8080   │ │ :8200 │ │  :8333  │
└───────┘ └─────────┘ └──────────┘ └───────┘ └─────────┘
```

## Data Persistence

Data is stored in Docker volumes:

| Volume | Contains |
|--------|----------|
| `aurora_postgres_data` | PostgreSQL database |
| `aurora_redis_data` | Redis data |
| `aurora_weaviate_data` | Vector embeddings |
| `aurora_vault_data` | Vault secrets |
| `aurora_seaweedfs_data` | Object storage |

### Backup Strategy

```bash
# Backup PostgreSQL
docker exec aurora-postgres-1 pg_dump -U aurora aurora_db > backup.sql

# Backup all volumes (stop services first)
make prod-down
tar -czvf aurora-backup.tar.gz /var/lib/docker/volumes/aurora_*
make prod
```

## Scaling Considerations

### Horizontal Scaling

For high availability, consider:

1. **External PostgreSQL** - Use managed PostgreSQL (RDS, Cloud SQL)
2. **External Redis** - Use managed Redis (ElastiCache, Memorystore)
3. **Load Balancer** - Multiple frontend/API instances behind LB
4. **Object Storage** - Use S3/R2 instead of SeaweedFS

### Resource Allocation

Recommended container resources for production:

```yaml
services:
  aurora-server:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G
        reservations:
          cpus: '1'
          memory: 2G

  celery_worker:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G

  frontend:
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1G
```

## Monitoring

### Health Checks

```bash
# API health
curl http://localhost:5080/health

# Vault health
curl http://localhost:8200/v1/sys/health

# All services
docker compose -f prod.docker-compose.yml ps
```

### Logs

```bash
# All logs
make prod-logs

# Specific service
make prod-logs aurora-server

# With timestamps
docker compose -f prod.docker-compose.yml logs -t aurora-server
```

## Troubleshooting

### Services Won't Start

```bash
# Check status
docker compose -f prod.docker-compose.yml ps

# Check specific service
docker logs aurora-server

# Verify .env
cat .env | grep -E "^[A-Z]" | head -20
```

### Database Connection Issues

```bash
# Check postgres is running
docker exec aurora-postgres-1 pg_isready

# Test connection
docker exec aurora-postgres-1 psql -U aurora -d aurora_db -c "SELECT 1"
```

### Out of Disk Space

```bash
# Check disk usage
docker system df

# Clean unused images
docker image prune -a

# Clean build cache
docker builder prune
```

## Security Checklist

- [ ] Change default passwords (auto-generated by `make init`)
- [ ] Use HTTPS with valid SSL certificates
- [ ] Restrict network access to necessary ports only
- [ ] Enable firewall rules
- [ ] Keep Docker and images updated
- [ ] Regular backups
- [ ] Monitor logs for anomalies
