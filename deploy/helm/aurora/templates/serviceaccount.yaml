# ------------------------------------------------------------------------------
# ServiceAccounts for Aurora services
# ------------------------------------------------------------------------------
# Security model:
# - Each service has its own ServiceAccount for identity separation
# - automountServiceAccountToken: false - no K8s API token mounted (minimum access)
# - No Roles/RoleBindings defined - services don't need K8s API access
# - Annotations available for cloud Workload Identity if needed
# ------------------------------------------------------------------------------

# Server ServiceAccount
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ include "aurora.fullname" . }}-server
  labels:
    {{- include "aurora.labels" . | nindent 4 }}
  {{- with .Values.serviceAccount.annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
automountServiceAccountToken: false
---
# Chatbot ServiceAccount
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ include "aurora.fullname" . }}-chatbot
  labels:
    {{- include "aurora.labels" . | nindent 4 }}
  {{- with .Values.serviceAccount.annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
automountServiceAccountToken: false
---
# Celery Worker ServiceAccount
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ include "aurora.fullname" . }}-celery-worker
  labels:
    {{- include "aurora.labels" . | nindent 4 }}
  {{- with .Values.serviceAccount.annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
automountServiceAccountToken: false
---
# Celery Beat ServiceAccount
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ include "aurora.fullname" . }}-celery-beat
  labels:
    {{- include "aurora.labels" . | nindent 4 }}
  {{- with .Values.serviceAccount.annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
automountServiceAccountToken: false
---
# Frontend ServiceAccount
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ include "aurora.fullname" . }}-frontend
  labels:
    {{- include "aurora.labels" . | nindent 4 }}
automountServiceAccountToken: false
---
# Vault ServiceAccount
{{- if .Values.services.vault.enabled }}
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ include "aurora.fullname" . }}-vault
  labels:
    {{- include "aurora.labels" . | nindent 4 }}
  {{- with .Values.serviceAccount.vault.annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
automountServiceAccountToken: false
{{- end }}
